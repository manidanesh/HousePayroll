# Auto-Update System Guide

## Overview

Your application now includes automatic update functionality via GitHub Releases. Users will be notified when new versions are available and can install them wi th one click.

## How It Works

### 1. Update Check Frequency
- **On startup:** Checks 3 seconds after app launches
- **Periodic:** Every 4 hours while app is running
- **Development mode:** Auto-update disabled (only works in packaged app)

### 2. User Experience Flow

**Step 1: Update Available**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update Available                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  A new version (1.1.0) is available!â”‚
â”‚                                      â”‚
â”‚  Would you like to download it now? â”‚
â”‚                                      â”‚
â”‚  [Download]  [Later]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Step 2: Downloading (background)**
- Download happens silently
- Progress logged to console
- User can continue working

**Step 3: Update Ready**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update Ready                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Version 1.1.0 has been downloaded  â”‚
â”‚  and is ready to install.           â”‚
â”‚                                      â”‚
â”‚  All your data will be preserved.   â”‚
â”‚                                      â”‚
â”‚  [Restart Now]  [Restart Later]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**If "Restart Later":**
- Update will install on next app quit

---

## Publishing a New Version

### Prerequisites
- GitHub account with access to repository
- Repository: `manidanesh/household-payroll`

### Step-by-Step Release Process

#### 1. Update Version Number
```bash
# Edit package.json
{
  "version": "1.1.0"  // Update this
}
```

#### 2. Build Signed Package
```bash
npm run package
```

This creates:
- `release/mac-arm64/Household Payroll-1.1.0-arm64.dmg`
- `release/mac-arm64/Household Payroll-1.1.0-arm64-mac.zip`

#### 3. Create GitHub Release

**Via GitHub Web Interface:**
1. Go to: https://github.com/manidanesh/household-payroll/releases/new
2. Click "Choose a tag" â†’ Type `v1.1.0` â†’ Click "Create new tag"
3. Release title: `v1.1.0`
4. Description: List changes/improvements
5. Attach files:
   - `Household Payroll-1.1.0-arm64.dmg`
   - `Household Payroll-1.1.0-arm64-mac.zip`
   - `latest-mac.yml` (auto-generated by electron-builder)
6. Check "Set as latest release"
7. Click "Publish release"

**Via Command Line:**
```bash
# Tag the version
git tag v1.1.0
git push origin v1.1.0

# Upload to GitHub using gh CLI
gh release create v1.1.0 \
  release/mac-arm64/Household\ Payroll-1.1.0-arm64.dmg \
  release/mac-arm64/Household\ Payroll-1.1.0-arm64-mac.zip \
  --title "v1.1.0" \
  --notes "Release notes here"
```

#### 4. Users Automatically Notified
- Next time users launch the app (or within 4 hours)
- They see "Update Available" notification
- One-click download and install

---

## Configuration Details

### Auto-Updater Settings
```typescript
autoUpdater.autoDownload = false;        // User must approve download
autoUpdater.autoInstallOnAppQuit = true; // Installs when app quits
```

### GitHub Configuration (package.json)
```json
{
  "build": {
    "publish": [
      {
        "provider": "github",
        "owner": "manidanesh",
        "repo": "household-payroll"
      }
    ]
  }
}
```

---

## Testing the Update System

### Test on Local Build

1. **Build packaged app:**
   ```bash
   npm run package
   ```

2. **Install the packaged app:**
   - Open `release/mac-arm64/Household Payroll-*.dmg`
   - Drag to `/Applications/`

3. **Create test release:**
   - Increment version to 1.0.1
   - Build again
   - Push to GitHub as v1.0.1

4. **Launch v1.0.0 app:**
   - Should detect v1.0.1 available
   - Prompt to download
   - Prompt to install

---

## Troubleshooting

### Updates Not Detected

**Check 1: Is app packaged?**
```bash
# Auto-update only works in packaged apps
# Check logs for: "Auto-updater disabled in development mode"
```

**Check 2: Is GitHub release public?**
- Repository must be public OR
- Include GitHub token for private repos

**Check 3: Check logs**
```bash
# macOS logs location:
~/Library/Logs/Household Payroll/main.log

# Look for:
"Checking for updates"
"Update available" or "No updates available"
```

### Update Download Fails

**Check internet connection:**
- Auto-updater requires internet to reach GitHub

**Check GitHub release assets:**
- Must include `.dmg`, `.zip`, and `latest-mac.yml`
- Files must be uploaded to the release

---

## Version Numbering Best Practices

### Semantic Versioning (MAJOR.MINOR.PATCH)

**Format:** `1.2.3`
- **MAJOR** (1): Breaking changes, data format changes
- **MINOR** (2): New features, backwards-compatible
- **PATCH** (3): Bug fixes, minor improvements

**Examples:**
- `1.0.0` â†’ `1.0.1` : Bug fix
- `1.0.1` â†’ `1.1.0` : New feature added
- `1.1.0` â†’ `2.0.0` : Major redesign or breaking change

---

## User Communication Template

When releasing an update, include in release notes:

```markdown
## What's New in v1.1.0

### âœ¨ New Features
- Added holiday pay multiplier support
- Weekend rate calculations

### ğŸ› Bug Fixes
- Fixed payroll calculation rounding
- Resolved database migration issues

### ğŸ”’ Data Safety
Your payroll data and settings will be automatically preserved during this update.

### ğŸ“¥ Installation
If you have auto-updates enabled, you'll be notified automatically. Otherwise, download the DMG file below.
```

---

## Privacy & Security

### Data Preservation
- âœ… Database remains in `~/Library/Application Support/`
- âœ… Not affected by app replacement
- âœ… All payroll history preserved

### Update Security
- âœ… Downloads only from GitHub (HTTPS)
- âœ… Code-signed DMG files
- âœ… User approval required before download
- âœ… User approval required before install

---

## Future Enhancements

### Possible Additions:
1. **Release Notes in App**
   - Show changelog before download
   
2. **Silent Updates**
   - Auto-download and install (optional)
   
3. **Update Channels**
   - Stable vs. Beta versions
   
4. **Rollback Capability**
   - Revert to previous version if needed

---

## Support

### Logs Location
```
~/Library/Logs/Household Payroll/main.log
```

### Force Check for Updates
Users can restart the app to trigger an immediate update check (3 seconds after startup).
